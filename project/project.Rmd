---
title: "What makes for a good historical popularity index?"
author: "Duke Squirrels"
date: "04/19/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

Your project goes here! Before you submit, make sure your chunks are turned off with `echo = FALSE`. 

## Load Packages

```{r load-packages, message=FALSE}
library(tidyverse)
library(broom)
```

## Load Data

```{r load-data, message=FALSE}
panth <- read_csv("data/cdatabase.csv",
                  na = c("Unknown", "1237?", "530s"))
```

## Introduction

The data that we obtained contains information regarding historical figures. We downloaded the data from Kaggle, but the data was collected by the Massachusetts Institute of Technology about a year ago. The data is based off of metrics from many wikipedia pages and believe the variables in the dataframe can be used to extrapolate what makes a historical figure "popular" by Wikipedia standards. 
For our write-up, we chose to focus on the variables `full_name`, `birth_year`, `latitude`, `longitude`, `occupation`, `sex`, and `industry`. However, in our linear full model, we will select more than just these variables. By the end of our data analysis, we aim to derive the perfect combination of variables that lead to a high popularity index, which is recorded in the dataframe.

### Section 1- Introduction to the Data

```{r filter_NAs}
panth_mod <- na.omit(panth)

panth_mod %>%
  ncol()

panth_mod %>%
  nrow()
```

There are 17 variables and 10,279 observations (with all NAs removed in the new dataframe). Before removing the NAs, the full dataframe had 11,341 observations.

```{r men-and-women}
panth_mod %>%
  count(sex)
```

Based on the filtered dataframe, there are 1,427 women and 8,852 men that are considered historical figures. 

```{r distribution-of-index}
panth_mod %>%
  ggplot(mapping = aes(x = historical_popularity_index)) +
  geom_histogram(bins = 20) + 
  labs(title = "Distribution of Historical Popularity Index Scores", y = "Count", 
       x = "Historical Popularity Index Score")

panth_mod %>%
  summarise(mean = mean(historical_popularity_index), 
            median = median(historical_popularity_index), 
            sd = sd(historical_popularity_index))
```

To get a better understanding of our dataset, we created a histogram that shows the distribution of the historical popularity index scores for the historical figures and ran summary statistics. The median score was 22.8723 and the mean was 22.14023. The distribution is left skewed and unimodal. 

##### Reference

http://www.dummies.com/programming/r/how-to-remove-rows-with-missing-data-in-r/

### Simple Linear Regression

```{r estimating_popularity_sex}
m_pop_sex <- lm(historical_popularity_index ~ sex , data = panth_mod)
tidy(m_pop_sex) %>%
  select(term, estimate)
```

Here we estimated the historical popularity index using the `sex` variable. The slope for the categorical variable `sexMale` is 1.55, suggesting that historical figures who are men have, on average, an increase in their overall popularity index of 1.55 as long as all other variables are held constant. 

The linear model, based on the output, is:

`(historical_popularity_index) = 20.8(intercept) + 1.55(sexMale)`

```{r r-squared}
glance(m_pop_sex)$r.squared
```

We found that the r-squared for the linear model `m_pop` is 2.54%, which suggests that 2.54% of the variability of the data can be explained by the linear model.

### Visual

```{r}
panth_mod %>%
  filter(continent != "Europe",
         article_languages > 50)%>%
  ggplot(mapping = aes(y = historical_popularity_index, x = article_languages,
                       color = factor(continent))) + geom_point(alpha = .5) + 
    geom_smooth(method = "lm", se = FALSE)+
    labs(x = "Article Languages", y = "Popularity Index", 
    title = "Effect of number of article languages on popularity index") 
    
```

### Multiple Linear Regression

```{r full_model}
m_full <- lm(historical_popularity_index ~ sex +
               domain +
               article_languages +
               continent +
               continent * article_languages,
             data = panth_mod)
tidy(m_full) %>%
  select(term, estimate)
```

Here we estimated the historical popularity index using the `sex`, `domain`, `article_languages`, and `continent` variables. We also included the interaction between continent and article languages. We would interpret the slope the same way we did with the simple linear regression above that had the `sex` variable only.

The linear model, based on the output, is:

`(historical_popularity_index) = 16.13336476	(intercept) + 1.51505537(sexMale) + 0.32594321	(domainBusiness & Law) +
0.56575963	(domainExploration) + 1.49018106	(domainHumanities) + 0.92757490	(domainInstitutions) + 1.01544834(domainPublic Figure) + 0.86254971(domainScience & Technology) + 	-4.37872010(domainSports) + 0.10057213	(article_languages)	+ 	1.59712745	(continentAsia) + 2.22815622	(continentEurope) + 1.46826358(continentNorth America	) + 	1.13423735(continentOceania) + 2.88294445	(continentSouth America) + -0.02635754(article_languages:continentAsia) + -0.02759474(article_languages:continentEurope) + -0.03508578(article_languages:continentNorth America) + -0.04278132(article_languages:continentOceania) + -0.05213559(article_languages:continentSouth America)`	

```{r full_r-squared}
glance(m_full)$r.squared
```

### Backwards Selection with AIC

```{r backwards_selection}
selected_model <- step(m_full, direction = "backward")

tidy(selected_model) %>%
  select(term, estimate)

glance(m_full)$AIC
```



## Conclusion
